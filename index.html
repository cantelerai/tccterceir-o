<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Igreja Assembleia - Gralha Azul</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* === ESTILOS CSS (mantidos do original) === */
        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color:#f5f7fa; color:#333; line-height:1.6; }
        .container { width:90%; max-width:1200px; margin:0 auto; padding:0 15px; }
        a { text-decoration:none; color:inherit; }
        ul { list-style:none; }
        img { max-width:100%; height:auto; }
        .btn { display:inline-block; padding:12px 24px; background-color:#3a6ea5; color:white; border-radius:4px; font-weight:600; transition:all .3s ease; border:none; cursor:pointer; }
        .btn:hover { background-color:#2c5282; transform:translateY(-2px); }
        .btn-outline { background-color:transparent; border:2px solid #3a6ea5; color:#3a6ea5; }
        .btn-outline:hover { background-color:#3a6ea5; color:white; }
        .btn-secondary { background-color:#718096; }
        .btn-secondary:hover { background-color:#4a5568; }
        .section-title { text-align:center; margin-bottom:50px; padding-top:30px; }
        .section-title h2 { font-size:2.5rem; color:#2d3748; margin-bottom:15px; }
        .section-title p { color:#718096; font-size:1.1rem; }

        header { background-color:white; box-shadow:0 2px 10px rgba(0,0,0,.1); position:fixed; width:100%; top:0; z-index:1000; }
        .header-content { display:flex; justify-content:space-between; align-items:center; padding:15px 0; }
        .logo { display:flex; align-items:center; font-size:1.5rem; font-weight:700; color:#3a6ea5; }
        .logo i { margin-right:10px; font-size:2rem; }
        nav ul { display:flex; }
        nav ul li { margin-left:30px; }
        nav ul li a { font-weight:600; transition:color .3s ease; }
        nav ul li a:hover, nav ul li a.active { color:#3a6ea5; }
        .mobile-menu-btn { display:none; font-size:1.5rem; cursor:pointer; }

        .hero { background:linear-gradient(rgba(0,0,0,.6), rgba(0,0,0,.6)), url('https://images.unsplash.com/photo-1518837695005-2083093ee35b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1770&q=80') no-repeat center center/cover; height:100vh; color:white; display:flex; align-items:center; text-align:center; margin-top:80px; }
        .hero-content h1 { font-size:3.5rem; margin-bottom:20px; }
        .hero-content p { font-size:1.2rem; margin-bottom:30px; max-width:600px; margin-left:auto; margin-right:auto; }
        .hero-buttons .btn { margin:0 10px; }

        .about { padding:100px 0; }
        .about-content { display:flex; align-items:center; gap:50px; }
        .about-text { flex:1; }
        .about-text p { margin-bottom:20px; font-size:1.1rem; line-height:1.8; }
        .about-image { flex:1; border-radius:10px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,.1); }

        .features { padding:100px 0; background-color:#f7fafc; }
        .features-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:30px; }
        .feature-card { background:white; padding:30px; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,.05); text-align:center; transition:transform .3s ease; }
        .feature-card:hover { transform:translateY(-10px); }
        .feature-icon { font-size:3rem; color:#3a6ea5; margin-bottom:20px; }
        .feature-content h3 { margin-bottom:15px; font-size:1.5rem; }

        .events { padding:100px 0; }
        .events-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:30px; }
        .event-card { display:flex; background:white; border-radius:10px; overflow:hidden; box-shadow:0 5px 15px rgba(0,0,0,.05); }
        .event-date { background-color:#3a6ea5; color:white; padding:20px; text-align:center; display:flex; flex-direction:column; justify-content:center; min-width:100px; }
        .event-date h3 { font-size:2rem; margin-bottom:5px; }
        .event-date span { font-size:1rem; text-transform:uppercase; }
        .event-content { padding:20px; }
        .event-content h3 { margin-bottom:10px; font-size:1.3rem; }
        .event-content p { margin-bottom:8px; display:flex; align-items:center; }
        .event-content i { margin-right:10px; color:#3a6ea5; }

        .sermons { padding:100px 0; background-color:#f7fafc; }
        .sermon-list { display:grid; grid-template-columns:repeat(auto-fit, minmax(500px, 1fr)); gap:30px; }
        .sermon-card { display:flex; background:white; border-radius:10px; overflow:hidden; box-shadow:0 5px 15px rgba(0,0,0,.05); }
        .sermon-img { width:150px; height:150px; object-fit:cover; }
        .sermon-content { padding:20px; flex:1; }
        .sermon-content h3 { margin-bottom:10px; font-size:1.5rem; }
        .sermon-content > p { margin-bottom:15px; }
        .sermon-content p strong { color:#3a6ea5; }
        .sermon-actions { display:flex; gap:10px; }
        .sermon-actions .btn { padding:8px 16px; font-size:.9rem; }

        .contact { padding:100px 0; }
        .contact-content { display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:50px; }
        .contact-info h3 { margin-bottom:20px; font-size:1.5rem; color:#2d3748; }
        .contact-info p { margin-bottom:15px; display:flex; align-items:center; }
        .contact-info i { margin-right:10px; color:#3a6ea5; width:20px; }
        .contact-form h3 { margin-bottom:20px; font-size:1.5rem; color:#2d3748; }
        .form-group { margin-bottom:20px; }
        .form-group input, .form-group textarea { width:100%; padding:12px 15px; border:1px solid #e2e8f0; border-radius:4px; font-family:inherit; font-size:1rem; }
        .form-group input:focus, .form-group textarea:focus { outline:none; border-color:#3a6ea5; }

        .donation { padding:100px 0; background-color:#f7fafc; text-align:center; }
        .donation-content { max-width:800px; margin:0 auto; }
        .donation-methods { display:flex; justify-content:center; gap:30px; margin-top:40px; flex-wrap:wrap; }
        .donation-method { background:white; padding:30px; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,.05); width:300px; text-align:center; }
        .donation-icon { font-size:3rem; color:#3a6ea5; margin-bottom:20px; }
        .pix-key { background:#f1f7ff; padding:15px; border-radius:8px; margin:20px 0; word-break:break-all; font-family:monospace; font-size:1.1rem; }
        .copy-btn { margin-top:10px; background:#3a6ea5; color:white; border:none; padding:8px 15px; border-radius:4px; cursor:pointer; transition:background .3s; }
        .copy-btn:hover { background:#2c5282; }

        footer { background-color:#2d3748; color:white; padding:50px 0 20px; }
        .footer-content { display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:40px; margin-bottom:30px; }
        .footer-section h3 { margin-bottom:20px; font-size:1.3rem; }
        .footer-section ul li { margin-bottom:10px; }
        .footer-section ul li a:hover { color:#3a6ea5; }
        .social-links { display:flex; gap:15px; margin-top:15px; }
        .social-links a { display:inline-flex; align-items:center; justify-content:center; width:40px; height:40px; background-color:rgba(255,255,255,.1); border-radius:50%; transition:all .3s ease; font-size:18px; }
        .social-links a:hover { background-color:#3a6ea5; transform:translateY(-3px); }
        .footer-bottom { text-align:center; padding-top:20px; border-top:1px solid rgba(255,255,255,.1); }

        @media (max-width:992px) { .about-content { flex-direction:column; } .sermon-list { grid-template-columns:1fr; } .donation-methods { flex-direction:column; align-items:center; } }
        @media (max-width:768px) {
            .header-content { position:relative; }
            nav { position:absolute; top:100%; left:0; right:0; background-color:white; padding:20px; box-shadow:0 5px 10px rgba(0,0,0,.1); display:none; }
            nav.active { display:block; }
            nav ul { flex-direction:column; }
            nav ul li { margin:10px 0; }
            .mobile-menu-btn { display:block; }
            .hero-content h1 { font-size:2.5rem; }
            .sermon-card { flex-direction:column; }
            .sermon-img { width:100%; height:200px; }
        }
        @media (max-width:576px) {
            .hero-buttons .btn { display:block; margin:10px auto; width:200px; }
            .section-title h2 { font-size:2rem; }
            .sermon-actions { flex-direction:column; }
            .pix-key { font-size:.9rem; padding:10px; }
        }

        /* === Admin modal & panel styles === */
        .admin-btn { margin-left:20px; }
        .modal { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,.5); z-index:2000; visibility:hidden; opacity:0; transition:opacity .2s ease; }
        .modal.show { visibility:visible; opacity:1; }
        .modal-card { background:white; padding:20px; border-radius:8px; width:360px; box-shadow:0 10px 30px rgba(0,0,0,.2); }
        .modal-card h3 { margin-bottom:10px; }
        .admin-panel { position:fixed; right:20px; top:100px; width:500px; max-height:80vh; overflow:auto; background:white; border-radius:8px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.2); z-index:1900; display:none; }
        .admin-panel.show { display:block; }
        .admin-panel h3 { margin-bottom:8px; }
        .admin-section { margin-bottom:18px; border-bottom:1px dashed #e6eef7; padding-bottom:12px; }
        .admin-section label { display:block; font-size:.9rem; margin-bottom:6px; color:#2d3748; }
        .small { font-size:.85rem; color:#666; margin-top:6px; }
        .item-row { display:flex; gap:8px; margin-bottom:8px; align-items:center; }
        .item-row input, .item-row textarea { flex:1; padding:8px 10px; border:1px solid #e2e8f0; border-radius:6px; font-size:.95rem; }
        .danger { background:#e53e3e; }
        .success { background:#38a169; }
        
        /* Estilos para as abas do admin */
        .admin-tab { 
            padding: 8px 16px; 
            background: none; 
            border: none; 
            cursor: pointer; 
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        .admin-tab.active { 
            border-bottom: 2px solid #3a6ea5; 
            color: #3a6ea5;
            font-weight: 600;
        }
        .admin-tab-content { 
            display: none; 
        }
        .admin-tab-content.active { 
            display: block; 
        }

        /* Estilos para a seção de emails */
        .email-item { 
            background: #f8fafc; 
            padding: 12px; 
            border-radius: 6px; 
            margin-bottom: 8px; 
            border-left: 4px solid #3a6ea5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .email-info { 
            flex: 1; 
        }
        .email-actions { 
            display: flex; 
            gap: 6px; 
        }
        .email-name { 
            font-weight: 600; 
            color: #2d3748; 
        }
        .email-address { 
            color: #718096; 
            font-size: 0.9rem; 
        }
        .email-category { 
            background: #e2e8f0; 
            padding: 2px 8px; 
            border-radius: 12px; 
            font-size: 0.8rem; 
            color: #4a5568;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        .stat-card {
            background: #f7fafc;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }
        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #3a6ea5;
        }
        .stat-label {
            font-size: 0.8rem;
            color: #718096;
        }
        .export-btn {
            background: #38a169;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        .export-btn:hover {
            background: #2f855a;
        }

        /* tiny helpers */
        .muted { color:#718096; font-size:.95rem; }
        .loading { opacity: 0.7; pointer-events: none; }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-church"></i>
                    <span>Igreja Assembleia</span>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" class="active">Início</a></li>
                        <li><a href="#sobre">Sobre</a></li>
                        <li><a href="#ministerios">Ministérios</a></li>
                        <li><a href="#eventos">Eventos</a></li>
                        <li><a href="#contato">Contato</a></li>
                        <li><a href="#doacao">Doações</a></li>
                    </ul>
                </nav>

                <div style="display:flex;align-items:center;">
                    <button id="openAdminBtn" class="btn btn-outline admin-btn"><i class="fas fa-user-shield"></i> Admin</button>
                    <div class="mobile-menu-btn">
                        <i class="fas fa-bars"></i>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <h1 id="heroTitle">Igreja Gralha Azul</h1>
                <p id="addressText">Rua Nossa Senhora do Pérpetuo Socorro - 322</p>
                <div class="hero-buttons">
                    <a href="#contato" class="btn">Visite-nos</a>
                    <a href="#eventos" class="btn btn-outline">Próximos Eventos</a>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="sobre" class="about">
        <div class="container">
            <div class="section-title">
                <h2 id="aboutTitle">Nossa história</h2>
                <p id="aboutSubtitle">A igreja Assembleia de Deus em Araúcaria tem como missão servir a comunidade local, pregando o Evangelho de Jesus Cristo e promovendo o crescimento espiritual.</p>
            </div>
            <div class="about-content">
                <div class="about-text">
                    <p id="outText1">Nossa congregação está localizada no Bairro Costeira e temos orgulho de fazer parte dessa comunidade há vários anos.</p>
                    <p id="aboutText2">Estamos comprometidos com os valores cristões e com o bem-estar espiritual de todos que buscam a Deus</p>
                </div>
                <div class="about-image">
                    <img src="https://images.unsplash.com/photo-1518837695005-2083093ee35b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80" alt="Igreja">
                </div>
            </div>
        </div>
    </section>

    <!-- Features -->
    <section id="ministerios" class="features">
        <div class="container">
            <div class="section-title">
                <h2 id="ministriesTitle">Carregando...</h2>
                <p id="ministriesSubtitle">Carregando...</p>
            </div>
            
            <div id="ministriesGrid" class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-spinner fa-spin"></i></div>
                    <div class="feature-content">
                        <h3>Carregando...</h3>
                        <p>Carregando ministérios...</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Events (renderizado dinamicamente) -->
    <section id="eventos" class="events">
        <div class="container">
            <div class="section-title">
                <h2 id="eventsTitle">Carregando...</h2>
                <p id="eventsSubtitle">Carregando...</p>
            </div>
            <div id="eventsGrid" class="events-grid">
                <div class="event-card">
                    <div class="event-date">
                        <h3>...</h3>
                        <span>...</span>
                    </div>
                    <div class="event-content">
                        <h3>Carregando eventos...</h3>
                        <p><i class="far fa-clock"></i> ...</p>
                        <p><i class="fas fa-map-marker-alt"></i> ...</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Sermons (renderizado dinamicamente) -->
    <section class="sermons">
        <div class="container">
            <div class="section-title">
                <h2 id="sermonsTitle">Carregando...</h2>
                <p id="sermonsSubtitle">Carregando...</p>
            </div>
            <div id="sermonList" class="sermon-list">
                <div class="sermon-card">
                    <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80" alt="Carregando" class="sermon-img">
                    <div class="sermon-content">
                        <h3>Carregando pregações...</h3>
                        <p><strong>...</strong> | ...</p>
                        <p>Carregando descrição...</p>
                        <div class="sermon-actions">
                            <a href="#" class="btn"><i class="fas fa-play"></i> Assistir</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact (dinâmico) -->
    <section id="contato" class="contact">
        <div class="container">
            <div class="section-title">
                <h2 id="contactTitle">Carregando...</h2>
                <p id="contactSubtitle">Carregando...</p>
            </div>
            <div class="contact-content">
                <div id="contactInfo" class="contact-info">
                    <h3>Informações de Contato</h3>
                    <p><i class="fas fa-map-marker-alt"></i> Carregando...</p>
                    <p><i class="fas fa-phone"></i> Carregando...</p>
                    <p><i class="fas fa-envelope"></i> Carregando...</p>
                    
                    <h3>Horários de Culto</h3>
                    <div>Carregando horários...</div>
                </div>
                <div class="contact-form">
                    <h3>Envie uma Mensagem</h3>
                    <form id="contactForm">
                        <div class="form-group">
                            <input type="text" id="contact_name" placeholder="Seu nome" required>
                        </div>
                        <div class="form-group">
                            <input type="email" id="contact_email" placeholder="Seu e-mail" required>
                        </div>
                        <div class="form-group">
                            <textarea id="contact_message" placeholder="Sua mensagem" rows="5" required></textarea>
                        </div>
                        <button type="submit" class="btn">Enviar Mensagem</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Donation Section -->
    <section id="doacao" class="donation">
        <div class="container">
            <div class="section-title">
                <h2 id="donationTitle">Carregando...</h2>
                <p id="donationSubtitle">Carregando...</p>
            </div>
            
            <div class="donation-content">
                <p id="donationText">Carregando...</p>
                
                <div class="donation-methods">
                    <div class="donation-method">
                        <div class="donation-icon">
                            <i class="fas fa-qrcode"></i>
                        </div>
                        <h3>PIX</h3>
                        <p id="pixDescription">Carregando...</p>
                        <div class="pix-key" id="pixKey">Carregando...</div>
                        <button class="copy-btn" onclick="copyPixKey()">
                            <i class="fas fa-copy"></i> Copiar Chave PIX
                        </button>
                        <p class="small-text">Chave PIX (CPF)</p>
                    </div>
                    
                    <div class="donation-method">
                        <div class="donation-icon">
                            <i class="fas fa-hand-holding-usd"></i>
                        </div>
                        <h3>Doação Presencial</h3>
                        <p id="presentialDonationText">Carregando...</p>
                        <p><i class="fas fa-clock"></i> Durante os horários de funcionamento</p>
                        <p><i class="fas fa-map-marker-alt"></i> Rua Nossa Senhora do Perpétuo Socorro, 322</p>
                    </div>
                </div>
                
                <div class="donation-info">
                    <p><strong>Observação:</strong> Todas as doações são utilizadas para a manutenção da igreja, projetos sociais e atividades comunitárias. Agradecemos sua contribuição!</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="logo">
                        <i class="fas fa-church"></i>
                        <span>Igreja Assembleia - Gralha Azul</span>
                    </div>
                    <p>Uma comunidade de fé, esperança e amor em Araucária.</p>
                </div>
                
                <div class="footer-section">
                    <h3>Links Rápidos</h3>
                    <ul>
                        <li><a href="#">Início</a></li>
                        <li><a href="#sobre">Sobre</a></li>
                        <li><a href="#ministerios">Ministérios</a></li>
                        <li><a href="#eventos">Eventos</a></li>
                        <li><a href="#contato">Contato</a></li>
                        <li><a href="#doacao">Doações</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Redes Sociais</h3>
                    <p>Siga-nos em nossas redes sociais</p>
                    <div class="social-links">
                        <a href="https://www.instagram.com/ad.gralha_azul?igsh=eWR6cTcxZ25tNXhy" target="_blank" title="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://www.facebook.com/suaigreja" target="_blank" title="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://youtube.com/@ieadargralhazul6791?si=M2JTqVTs8BDBVVGH" target="_blank" title="YouTube">
                            <i class="fab fa-youtube"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; Igreja Assembleia de Deus - Araucária. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="modal" aria-hidden="true">
        <div class="modal-card">
            <h3>Login Administrativo</h3>
            <p class="muted">Entre com e-mail e senha</p>
            <div style="margin-top:10px;">
                <label for="adminEmail" class="muted">E-mail</label>
                <input id="adminEmailInput" type="email" placeholder="seu@email.com" style="width:100%; padding:8px 10px; border-radius:6px; border:1px solid #e2e8f0;">
                <label for="adminPass" class="muted" style="margin-top:8px; display:block;">Senha</label>
                <input id="adminPass" type="password" placeholder="senha" style="width:100%; padding:8px 10px; border-radius:6px; border:1px solid #e2e8f0;">
                <div style="display:flex; gap:8px; margin-top:12px; justify-content:flex-end;">
                    <button id="cancelLogin" class="btn btn-outline">Cancelar</button>
                    <button id="submitLogin" class="btn">Entrar</button>
                </div>
                <p class="small muted" style="margin-top:8px;">(credenciais padrão: <strong>admin@igreja.com</strong> / <strong>123456</strong>)</p>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <aside id="adminPanel" class="admin-panel" aria-hidden="true">
        <!-- (mantido) -->
        <!-- ... conteúdo do painel admin ... -->
    </aside>

    <!-- === SCRIPT CORRIGIDO === -->
    <script>
      // ===== SUPABASE CLIENT (usa window.supabase) =====
      const SUPABASE_URL = 'https://xskasveyyprxuuilkavit.supabase.co';
      const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhza2FzdnNleXB2eHV1bGtldmlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyOTEyODgsImV4cCI6MjA3Mzg2NzI4OH0.QMJOGkErNQPhW0ZnRKc6fC5f7Wxze68GnW7hf9lmMXo';
      const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      // ===== helpers =====
      const $ = (s) => document.querySelector(s);
      const setText = (id, v) => { const el = document.getElementById(id); if (el && v != null) el.textContent = v; };
      const html = (s,...v)=>s.map((p,i)=>p+(v[i]??'')).join('');
      const PT_MONTH_INDEX = { jan:0, fev:1, mar:2, abr:3, mai:4, jun:5, jul:6, ago:7, set:8, out:9, nov:10, dez:11 };
      const monthToIndex = (m)=> m? PT_MONTH_INDEX[m.trim().toLowerCase().slice(0,3).normalize('NFD').replace(/\p{Diacritic}/gu,'')] ?? 99 : 99;
      const parseDayNumber = (d)=>{ const m = String(d||'').match(/(\d{1,2})/); return m? parseInt(m[1],10):99; };
      function inlineError(targetId,msg){ const el=document.getElementById(targetId); if(el) el.innerHTML=`<p class="muted" style="color:#e53e3e">${msg}</p>`; console.error(msg); }

      // ===== site_config (key/value) =====
      async function loadSiteConfig(){
        const { data, error } = await sb.from('site_config').select('key,value');
        if (error){ console.error(error); return; }
        const cfg = Object.fromEntries((data||[]).map(r=>[r.key, r.value]));

        // Hero / About / etc (chaves conforme seus INSERTs)
        setText('heroTitle', cfg.heroTitle);
        setText('addressText', cfg.address);

        setText('aboutTitle', cfg.aboutTitle);
        setText('aboutSubtitle', cfg.aboutSubtitle);
        setText('aboutText1', cfg.aboutText1);
        setText('aboutText2', cfg.aboutText2);
        setText('aboutText3', cfg.aboutText3);

        setText('ministriesTitle', cfg.ministriesTitle);
        setText('ministriesSubtitle', cfg.ministriesSubtitle);

        setText('eventsTitle', cfg.eventsTitle);
        setText('eventsSubtitle', cfg.eventsSubtitle);

        setText('sermonsTitle', cfg.sermonsTitle);
        setText('sermonsSubtitle', cfg.sermonsSubtitle);

        setText('contactTitle', cfg.contactTitle);
        setText('contactSubtitle', cfg.contactSubtitle);

        setText('donationTitle', cfg.donationTitle);
        setText('donationSubtitle', cfg.donationSubtitle);
        setText('donationText', cfg.donationText);
        setText('pixDescription', cfg.pixDescription);
        setText('presentialDonationText', cfg.presentialDonationText);
        setText('pixKey', cfg.pix);

        const contactInfo = $('#contactInfo');
        if (contactInfo){
          const times = (cfg.serviceTimes||'').split(/\r?\n/).map(s=>s.trim()).filter(Boolean)
            .map(l=>`<li><i class="fas fa-clock"></i> ${l}</li>`).join('');
          contactInfo.innerHTML = html`
            <h3>Informações de Contato</h3>
            ${cfg.address? `<p><i class="fas fa-map-marker-alt"></i> ${cfg.address}</p>`:''}
            ${cfg.phone? `<p><i class="fas fa-phone"></i> ${cfg.phone}</p>`:''}
            ${cfg.email? `<p><i class="fas fa-envelope"></i> ${cfg.email}</p>`:''}
            <h3>Horários de Culto</h3>
            ${times? `<ul>${times}</ul>`:'<div>—</div>'}
          `;
        }
      }

      // ===== ministries =====
      async function loadMinistries(){
        const grid = $('#ministriesGrid'); if(!grid) return;
        const { data, error } = await sb.from('ministries').select('*').order('id',{ascending:true});
        if (error){ inlineError('ministriesGrid','Erro ao carregar ministérios.'); return; }
        if (!data || data.length===0){ grid.innerHTML="<p class='muted'>Nenhum ministério cadastrado.</p>"; return; }
        grid.innerHTML = data.map(m=>html`
          <div class="feature-card">
            <div class="feature-icon"><i class="${m.icon||'fas fa-people-group'}"></i></div>
            <div class="feature-content">
              <h3>${m.name}</h3>
              <p>${m.description??''}</p>
            </div>
          </div>
        `).join('');
      }

      // ===== events (day, month, title, time, location) =====
      async function loadEvents(){
        const grid = $('#eventsGrid'); if(!grid) return;
        const { data, error } = await sb.from('events').select('id,day,month,title,time,location,created_at');
        if (error){ inlineError('eventsGrid','Erro ao carregar eventos.'); return; }
        if (!data || data.length===0){ grid.innerHTML="<p class='muted'>Nenhum evento por enquanto.</p>"; return; }

        const sorted = data.slice().sort((a,b)=>{
          const ma = monthToIndex(a.month), mb = monthToIndex(b.month);
          if (ma!==mb) return ma-mb;
          return parseDayNumber(a.day)-parseDayNumber(b.day);
        });

        grid.innerHTML = sorted.map(ev=>{
          const day = String(ev.day||'').split(' ')[0] || '--';
          const mon = (ev.month||'--').toUpperCase();
          return html`
            <div class="event-card">
              <div class="event-date">
                <h3>${day}</h3><span>${mon}</span>
              </div>
              <div class="event-content">
                <h3>${ev.title}</h3>
                ${ev.time? `<p><i class="far fa-clock"></i> ${ev.time}</p>`:''}
                ${ev.location? `<p><i class="fas fa-map-marker-alt"></i> ${ev.location}</p>`:''}
              </div>
            </div>
          `;
        }).join('');
      }

      // ===== sermons (title, pastor, date, img_url, video_url, description) =====
      async function loadSermons(){
        const list = $('#sermonList'); if(!list) return;
        const { data, error } = await sb.from('sermons').select('*').order('id',{ascending:false}).limit(6);
        if (error){ inlineError('sermonList','Erro ao carregar pregações.'); return; }
        if (!data || data.length===0){ list.innerHTML="<p class='muted'>Sem pregações cadastradas ainda.</p>"; return; }

        list.innerHTML = data.map(s=>html`
          <div class="sermon-card">
            <img class="sermon-img" src="${s.img_url||'https://picsum.photos/300/300?grayscale'}" alt="${s.title}">
            <div class="sermon-content">
              <h3>${s.title}</h3>
              <p><strong>${s.pastor ?? '—'}</strong> | ${s.date ?? ''}</p>
              ${s.description? `<p>${s.description}</p>`:''}
              <div class="sermon-actions">
                ${s.video_url? `<a class="btn" href="${s.video_url}" target="_blank"><i class="fas fa-play"></i> Assistir</a>`:''}
              </div>
            </div>
          </div>
        `).join('');
      }

      // ===== contato -> emails =====
      function bindContactForm(){
        const form = $('#contactForm'); if(!form) return;
        form.addEventListener('submit', async (e)=>{
          e.preventDefault();
          const name = $('#contact_name')?.value?.trim();
          const email = $('#contact_email')?.value?.trim();
          const message = $('#contact_message')?.value?.trim();
          if(!name||!email||!message){ alert('Preencha todos os campos.'); return; }

          try{
            // tenta com message (se coluna existir)
            let { error } = await sb.from('emails').insert([{ name, email, category:'visitante', subscribed:true, message }]);
            if (error){
              // fallback sem message
              const r2 = await sb.from('emails').insert([{ name, email, category:'visitante', subscribed:true }]);
              if (r2.error) throw r2.error;
            }
            alert('Mensagem enviada! Obrigado pelo contato.');
            form.reset();
          }catch(err){
            console.error(err);
            alert('Erro ao enviar. Tente novamente.');
          }
        });
      }

      // ===== UI =====
      function bindMobileMenu(){
        const btn = document.querySelector('.mobile-menu-btn');
        const nav = document.querySelector('header nav');
        if(!btn||!nav) return;
        btn.addEventListener('click', ()=> nav.classList.toggle('active'));
        nav.querySelectorAll('a').forEach(a=> a.addEventListener('click', ()=> nav.classList.remove('active')));
      }
      window.copyPixKey = function(){
        const key = document.getElementById('pixKey')?.textContent?.trim()||'';
        if(!key) return;
        navigator.clipboard.writeText(key).then(()=>alert('Chave PIX copiada!')).catch(()=>alert('Não foi possível copiar a chave.'));
      };

      // ===== init =====
      document.addEventListener('DOMContentLoaded', async ()=>{
        bindMobileMenu();
        bindContactForm();

        await loadSiteConfig();
        await Promise.all([ loadMinistries(), loadEvents(), loadSermons() ]);
      });

      // placeholder do admin (mantém igual)
      function setupAdminFunctionality(){}
    </script>
</body>
</html>
